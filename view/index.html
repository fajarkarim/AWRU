<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>OO AwwRU!!</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.10/semantic.min.css">
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"
    integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
    crossorigin="anonymous">
    </script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://unpkg.com/vue"></script>
    <style media="screen">
      h1.ui.header{
        font-size: 4rem;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <div class="ui fluid container" style="padding-top: 150px;">
        <div class="ui middle aligned center aligned grid">
          <div class="ui center aligned icon header">
            <i class="massive circular first aid icon"></i>
            <h1 class="ui header">Welcome To AwwR-U!! App</h1>
            <p>A Simple Urgent Helper Application</p>
            <button type="button" class="ui vertical animated button" tabindex="0" style="width: 190px; height: 90px;" v-on:click="getSpeech">
              <div class="visible content">
                <h2>Click Here!</h2>
              </div>
              <div class="hidden content" style="padding-bottom:70px;">
                <i class="unmute icon"></i>
              </div>
            </button>
          </div>
        </div>
        <div class="ui form">
          <div class="field">
            <br><br>
            <input id="record" type="text" name="" style="margin: 300px; padding-left: 550px; padding-right:400px;" v-model="speech">
          </div>
        </div>
      </div>
      <div class="ui inverted bottom fixed menu">
        <div class="item">
          <button type="button" name="button" class="ui twitter button" v-on:click="toTwitterPage">
            <i class="twitter icon"></i>
            Twitter
          </button>
        </div>
        <div class="item">
          <button type="button" name="button" class="ui labeled icon button" v-on:click="getRecord">
            <i class="grid layout icon"></i>
            show history
          </button>
        </div>
      </div>
    <div v-if="speech == 'aduh'">
      <div class="ui basic modal">
        <div class="ui icon header">
          <i class="doctor icon"></i>
          Hey Dude! Whats Up Bro?? Are You Fine??
        </div>
        <div class="content">
          <p>Whats Are You Condition Now, Please Select Your Contition, Urgent or not? We will respect your choise!</p>
        </div>
        <div class="actions">
          <button class="ui green basic inverted button" v-on:click="getSickAction">
            <i class="thumbs up icon"></i>
            No, Thats not urgent
          </button>
          <button class="ui red inverted button" v-on:click="getUrgentAction">
            <i class="frown icon"></i>
            Yes, Please its very urgent
          </button>
        </div>
      </div>
    </div>


    <div class="ui modal" id="modal1">
      <i class="close icon"></i>
      <div class="header">
        Emergency Warning!, we have send status on tweeter
      </div>
      <div class="image content">
        <div class="ui medium image">
          <iframe src="maps.html" width="850px" height="300px"></iframe>
        </div>
      </div>
      <div class="actions">
        <div class="ui black deny button">
          No, Thanks
        </div>
        <div class="ui positive ok right lebeled icon button">
          Yes, Im Wanna There
          <i class="checkmark icon"></i>
        </div>
      </div>
    </div>


    <div class="ui coba modal" id="modal2">
      <i class="close icon"></i>
      <div class="header">
        What do you feel?
      </div>
      <div class="ui text container" style="padding-bottom:10px">
        <div class="ui form">
          <div class="field">
            <label>input what do you want to search</label>
            <textarea v-model="sick"></textarea>
          </div>
        </div>
      </div>
      <div class="actions">
        <div class="ui black deny button">
          No, Thanks
        </div>
        <button class="ui positiv violet right lebeled icon button" v-on:click="getSpeechSearch">
          press and speech
          <i class="unmute icon"></i>
        </button>
        <button class="ui positive ok right lebeled icon button" v-on:click="toSearchPage">
          Yes, Im Wanna There
          <i class="google icon"></i>
        </button>
      </div>
    </div>

    <div class="ui basic modal" id="modal3">
      <i class="close icon"></i>
      <div class="header">
        Your History!
      </div>
      <div class="ui text container" style="padding-bottom:10px">
        <table class="ui celled table">
          <thead>
            <tr>
              <th>Category</th>
              <th>Your Situation</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="recapulation in recapulations">
              <td>{{ recapulation.category }}</td>
              <td>{{ recapulation.action }}</td>
            </tr>
          </tbody>
        </table>
      <div class="actions">
        <div class="ui black deny button">
          OK
        </div>
      </div>
    </div>


  </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.10/semantic.min.js"></script>
  </body>
  <script type="text/javascript">
    var SpeechRecognition = SpeechRecognition || webkitSpeechRecognition;
    var SpeechRecognitionEvent = SpeechRecognitionEvent || webkitSpeechRecognitionEvent;
    //var r = document.getElementById('record');

    var app = new Vue({
      el: '#app',
      data: {
        listPlace: [],
        speech: '',
        sick: '',
        page: '',
        category: '',
        action: '',
        recapulations: []
      },
      methods: {
        getRecord: function(){
          let self = this
          axios.get('http://localhost:3000/api/')
          .then((response)=>{
            this.recapulations = response.data
          })
          .catch((err)=>{
            console.log(err);
          })
          self.getRecordModal()
        },
        toTwitterPage: function(){
          window.open('https://twitter.com/derijimmu', '_blank');
        },
        toSearchPage: function(){
          let self = this
          axios.post('http://localhost:3000/api/', {
            category: 'not urgent',
            action : `search to google about ${self.sick}`
          })
          .then((response)=>{
            console.log(response);
          })
          .catch((err)=>{
            console.log(err);
          })
          this.page = 'http://google.com/search?q='+this.sick.split(" ").join("+");
          window.open(this.page, '_blank');
        },
        getSpeechSearch: function(){
          var self = this
          if('webkitSpeechRecognition' in window){
            var speechRecognizer = new webkitSpeechRecognition();
            speechRecognizer.continuous = true;
            speechRecognizer.interimResults = true;
            speechRecognizer.lang = 'id-ID';
            speechRecognizer.start();

            var finalTranscripts = '';

            speechRecognizer.onresult = function(event){
              var interimTranscripts = '';
              for(var i = event.resultIndex; i < event.results.length; i++){
                var transcript = event.results[i][0].transcript;

                transcript.replace("\n", "<br>");
                if(event.results[i].isFinal){
                  finalTranscripts += transcript;
                }else{
                  interimTranscripts += transcript;
                }
              }
              self.sick = finalTranscripts + interimTranscripts ;
              // if(self.speech === 'aduh' || 'sakit'){
              //   self.activateModalChoose()
              // }

            };
            speechRecognizer.onerror = function (event) {
            };
          }else{
            self.speech = 'Your browser is not supported. If google chrome, please upgrade!';
          }
        },
        getSpeech: function(){
          var self = this
          if('webkitSpeechRecognition' in window){
            var speechRecognizer = new webkitSpeechRecognition();
            speechRecognizer.continuous = true;
            speechRecognizer.interimResults = true;
            speechRecognizer.lang = 'id-ID';
            speechRecognizer.start();

            var finalTranscripts = '';

            speechRecognizer.onresult = function(event){
              var interimTranscripts = '';
              for(var i = event.resultIndex; i < event.results.length; i++){
                var transcript = event.results[i][0].transcript;

                transcript.replace("\n", "<br>");
                if(event.results[i].isFinal){
                  finalTranscripts += transcript;
                }else{
                  interimTranscripts += transcript;
                }
              }
              self.speech = finalTranscripts + interimTranscripts ;
              if(self.speech === 'aduh'){
                self.activateModalChoose()
                speechRecognizer.stop()
              } else {
                alert('Jangan Main2 bro!!')
              }
            };
            speechRecognizer.onerror = function (event) {
            };
          }else{
            self.speech = 'Your browser is not supported. If google chrome, please upgrade!';
          }

        },
        activateModalChoose: function(){
          $('.ui.basic.modal')
            .modal('show')
          ;
        },
        getUrgentAction: function(){
          let self = this

          axios.post('http://localhost:3000/api/twitter')
          .then((response)=>{
            console.log('success to post status on twitter', response);
          })
          .catch((err)=>{
            console.log(err);
          })
          axios.post('http://localhost:3000/api/', {
            category: 'urgen',
            action: 'sakit dan pergi kerumah sakit'
          })
          .then((response)=>{
            console.log('success');
          })
          .catch((err)=>{
            console.log(err);
          })
          this.getUrgentModal()
        },
        getSickAction: function(){
          let self = this
          this.getSickModal()
        },
        getUrgentModal: function(){
          $('#modal1')
            .modal('show')
          ;
        },
        getSickModal: function() {
          $('#modal2')
            .modal('show');
        },
        getRecordModal: function(){
          $('#modal3')
            .modal('show');
        }
      }
    })
  </script>
</html>
